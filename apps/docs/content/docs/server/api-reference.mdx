---
title: API Reference
description: Complete reference for the Ablauf class and related types
---

# API Reference

Complete reference for the Ablauf class, its methods, and related types.

## Ablauf Class

The main API for creating and managing workflows.

### Constructor

```ts
new Ablauf(binding: DurableObjectNamespace, config?: AblaufConfig)
```

**Parameters:**

- `binding` — The `WORKFLOW_RUNNER` Durable Object namespace from your worker's `env`
- `config` — Optional configuration object

**Config Options:**

<AutoTypeTable path="../../packages/workflows/src/client.ts" name="AblaufConfig" />

**Example:**

```ts
const ablauf = new Ablauf(env.WORKFLOW_RUNNER, {
	workflows: [OrderWorkflow, [HighVolumeWorkflow, { shards: 8 }]],
	observability: true,
});
```

---

### Methods

#### `create()`

Create and start a new workflow instance.

```ts
create<Payload, Result, Events extends object, Type extends string>(
  workflow: WorkflowClass<Payload, Result, Events, Type>,
  props: { id: string; payload: Payload }
): Promise<TypedWorkflowRunnerStub<Payload, Result, Events, Type>>
```

**Parameters:**

- `workflow` — The workflow class to instantiate
- `props.id` — Workflow instance ID
- `props.payload` — Input payload (validated against workflow's `inputSchema`)

**Returns:**

A typed `TypedWorkflowRunnerStub` for interacting with the workflow instance.

**Throws:**

- `PayloadValidationError` — If payload validation fails
- `WorkflowAlreadyExistsError` — If a workflow with the given ID already exists

**Example:**

```ts
const stub = await ablauf.create(OrderWorkflow, {
  id: "order-123",
  payload: { orderId: "123", items: [...] },
});

const status = await stub.getStatus();
```

---

#### `sendEvent()`

Send a typed event to a running workflow.

```ts
sendEvent<Payload, Result, Events extends object, Type extends string>(
  workflow: WorkflowClass<Payload, Result, Events, Type>,
  props: { id: string } & WorkflowEventProps<Events>
): Promise<void>
```

**Parameters:**

- `workflow` — The workflow class (for type inference)
- `props.id` — Workflow instance ID
- `props.event` — Event name
- `props.payload` — Event payload (validated against event schema)

**Throws:**

- `EventValidationError` — If event payload validation fails
- `WorkflowNotFoundError` — If the workflow instance doesn't exist

**Example:**

```ts
await ablauf.sendEvent(OrderWorkflow, {
	id: 'order-123',
	event: 'payment-received',
	payload: { amount: 99.99, transactionId: 'tx-456' },
});
```

---

#### `status()`

Get the current status of a workflow instance.

```ts
// Untyped
status(id: string): Promise<WorkflowStatusResponse>

// Typed
status<Payload, Result, Events extends object, Type extends string>(
  id: string,
  workflow: WorkflowClass<Payload, Result, Events, Type>
): Promise<WorkflowStatusResponseFor<Payload, Result, Type>>
```

**Parameters:**

- `id` — Workflow instance ID
- `workflow` — Optional workflow class for type inference

**Returns:**

A `WorkflowStatusResponse` with the current state, payload, result, steps, and metadata.

**Example:**

```ts
// Untyped
const status = await ablauf.status('order-123');

// Typed
const status = await ablauf.status('order-123', OrderWorkflow);
// status.payload is typed as OrderPayload
// status.result is typed as OrderResult | null
```

---

#### `pause()`

Pause a running workflow.

```ts
pause(id: string): Promise<void>
```

The workflow will finish its current step, then pause before the next one. It can be resumed with `resume()`.

---

#### `resume()`

Resume a paused workflow.

```ts
resume(id: string): Promise<void>
```

The workflow replays its execution history and continues from where it paused.

---

#### `terminate()`

Permanently terminate a workflow.

```ts
terminate(id: string): Promise<void>
```

The workflow is permanently stopped and cannot be resumed. Its state remains stored.

---

#### `waitForUpdate()`

Wait for a specific SSE update from a running workflow.

```ts
waitForUpdate<...>(
  workflow: WorkflowClass,
  props: { id: string; update: string; timeout?: string }
): Promise<SSEUpdates[K]>
```

**Parameters:**

- `workflow` — The workflow class (for type inference)
- `props.id` — Workflow instance ID
- `props.update` — The SSE event name to wait for
- `props.timeout` — Optional timeout as a duration string (e.g., `"30s"`, `"5m"`)

**Throws:**

- `UpdateTimeoutError` — If the timeout expires before the update arrives
- `WorkflowNotRunningError` — If the workflow completes or errors before the update

**Example:**

```ts
const progress = await ablauf.waitForUpdate(OrderWorkflow, {
	id: 'order-123',
	update: 'progress',
	timeout: '30s',
});
```

---

#### `list()`

List workflow instances of a specific type.

```ts
list(
  type: string,
  filters?: WorkflowIndexListFilters
): Promise<WorkflowIndexEntry[]>
```

**Parameters:**

- `type` — Workflow type (e.g., `"process-order"`)
- `filters.status` — Optional status filter
- `filters.limit` — Optional result limit (sorted by `updatedAt`, newest first)

**Throws:**

- `ObservabilityDisabledError` — If observability is disabled

**Example:**

```ts
const running = await ablauf.list('process-order', { status: 'running' });
const recent = await ablauf.list('process-order', { limit: 10 });
```

---

#### `createWorkflowRunner()`

Returns the Durable Object class to export from your worker.

```ts
createWorkflowRunner(overrides?: { binding?: string }): typeof WorkflowRunner
```

**Example:**

```ts
export const WorkflowRunner = ablauf.createWorkflowRunner();
```

---

#### `createRPCHandler()`

Returns an oRPC handler for the dashboard API.

**Example:**

```ts
const rpcHandler = ablauf.createRPCHandler();

app.use('/__ablauf/*', async (c, next) => {
	const { matched, response } = await rpcHandler.handle(c.req.raw, {
		prefix: '/__ablauf',
		context: ablauf.getDashboardContext(),
	});
	if (matched) return c.newResponse(response.body, response);
	await next();
});
```

---

## Types

### Step

The step API available inside workflow `run()` functions.

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="Step" />

---

### SSE

The Server-Sent Events API available inside workflow `run()` functions.

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="SSE" />

---

### RetryConfig

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="RetryConfig" />

---

### StepDoOptions

Options for `step.do()`:

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="StepDoOptions" />

---

### StepWaitOptions

Options for `step.waitForEvent()`:

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="StepWaitOptions" />

---

### WorkflowStatus

```ts
type WorkflowStatus =
	| 'created' // Initial state after creation
	| 'running' // Actively executing steps
	| 'completed' // All steps finished successfully
	| 'errored' // A step or validation error occurred
	| 'paused' // Manually paused via pause()
	| 'sleeping' // Waiting for a step.sleep() timer
	| 'waiting' // Waiting for a step.waitForEvent() delivery
	| 'terminated'; // Permanently stopped via terminate()
```

---

### WorkflowStatusResponse

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="WorkflowStatusResponse" />

---

### StepInfo

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="StepInfo" />

---

### WorkflowIndexEntry

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="WorkflowIndexEntry" />

---

### WorkflowIndexListFilters

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="WorkflowIndexListFilters" />

---

### WorkflowShardConfig

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="WorkflowShardConfig" />

---

### WorkflowClass

The interface that workflow definitions (both class-based and functional) must satisfy.

<AutoTypeTable path="../../packages/workflows/src/engine/types.ts" name="WorkflowClass" />

---

## Duration Strings

Ablauf uses human-readable duration strings in several places (e.g., `step.sleep()`, `step.waitForEvent()` timeout).

### Supported Formats

| Format | Example   | Description  |
| ------ | --------- | ------------ |
| `Nms`  | `"500ms"` | Milliseconds |
| `Ns`   | `"30s"`   | Seconds      |
| `Nm`   | `"5m"`    | Minutes      |
| `Nh`   | `"1h"`    | Hours        |
| `Nd`   | `"7d"`    | Days         |

### Examples

```ts
await step.sleep('cooldown', '30s'); // 30 seconds
await step.sleep('backoff', '5m'); // 5 minutes
await step.sleep('daily', '1h'); // 1 hour

const result = await step.waitForEvent('payment-received', {
	timeout: '10m', // 10 minutes
});
```

**Throws:**

`InvalidDurationError` if the duration string is malformed.

---

## Error Classes

All errors thrown by Ablauf extend `WorkflowError`, which extends Hono's `HTTPException`. Every error has a `code`, `status`, `source`, and `message`.

| Error Class                  | Code                      | Status | Source     |
| ---------------------------- | ------------------------- | ------ | ---------- |
| `WorkflowNotFoundError`      | `WORKFLOW_NOT_FOUND`      | 404    | api        |
| `ResourceNotFoundError`      | `RESOURCE_NOT_FOUND`      | 404    | api        |
| `WorkflowAlreadyExistsError` | `WORKFLOW_ALREADY_EXISTS` | 409    | engine     |
| `WorkflowTypeUnknownError`   | `WORKFLOW_TYPE_UNKNOWN`   | 400    | api        |
| `PayloadValidationError`     | `VALIDATION_ERROR`        | 400    | validation |
| `EventValidationError`       | `EVENT_INVALID`           | 400    | validation |
| `StepFailedError`            | `STEP_FAILED`             | 500    | step       |
| `StepRetryExhaustedError`    | `STEP_RETRY_EXHAUSTED`    | 500    | step       |
| `EventTimeoutError`          | `EVENT_TIMEOUT`           | 408    | engine     |
| `UpdateTimeoutError`         | `UPDATE_TIMEOUT`          | 408    | engine     |
| `WorkflowNotRunningError`    | `WORKFLOW_NOT_RUNNING`    | 409    | engine     |
| `DuplicateStepError`         | `VALIDATION_ERROR`        | 400    | engine     |
| `InvalidDurationError`       | `VALIDATION_ERROR`        | 400    | validation |
| `ObservabilityDisabledError` | `OBSERVABILITY_DISABLED`  | 400    | api        |

### Error JSON Shape

All `WorkflowError` instances serialize to:

```json
{
	"error": {
		"code": "WORKFLOW_NOT_FOUND",
		"message": "Workflow \"order-123\" not found",
		"status": 404,
		"source": "api"
	}
}
```

### Discriminating Errors

Across Durable Object RPC boundaries, errors lose their class identity. Use `err.code` to discriminate:

```ts
try {
	await ablauf.status('order-123');
} catch (e) {
	if (e instanceof WorkflowError && e.code === 'WORKFLOW_NOT_FOUND') {
		// handle not found
	}
}
```
